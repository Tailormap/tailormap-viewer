<ng-template #treeNode let-node>
  <tm-toc-node-layer
    [node]="node"
    [scale]="scale"
    [in3D]="in3D()"
    [layersWithoutWebMercator]="layersWithoutWebMercator()"
    [tiles3DLayerIds]="tiles3DLayerIds()"
    [filteredLayerIds]="filteredLayerIds()"
    (zoomToScale)="zoomToScale($event)"></tm-toc-node-layer>
</ng-template>

@if (visible$ | async) {
  <div class="toc">
    <div class="toc-header">
      <div class="toc-header-left">
        <tm-toggle-all-layers-button></tm-toggle-all-layers-button>
        <button mat-icon-button
          color="primary"
          i18n-tmTooltip="@@core.toc.filter-layers"
          class="map-control-button"
          tmTooltip="Filter layers"
          (click)="toggleLayerFilter()">
          <mat-icon svgIcon="search"></mat-icon>
        </button>
      </div>
      <div class="toc-header-right">
        @if (isMobileDevice) {
          <button
            mat-icon-button
            tmTooltip="Re-order layers"
            i18n-tmTooltip="@@core.toc.reorder-layers"
            color="primary"
            [class.button--active]="dragDropEnabled"
            (click)="toggleReordering()">
            <mat-icon svgIcon="reorder"></mat-icon>
          </button>
        }
      </div>
    </div>
    @if (filterEnabled$ | async) {
      <div class="toc-search">
        <tm-toc-filter-input></tm-toc-filter-input>
      </div>
    }
    <tm-tree class="toc-tree"
      [treeNodeTemplate]="treeNode"
      [expandOnGroupClick]="true"
    [getDropZones]="getDropZoneConfig()"></tm-tree>
    @if (infoTreeNode$ | async; as infoTreeNode) {
      @if (infoVisible()) {
        <tm-toc-node-details [node]="infoTreeNode" (closeDetails)="layerInfoClosed()"></tm-toc-node-details>
      }
    }
  </div>
}
