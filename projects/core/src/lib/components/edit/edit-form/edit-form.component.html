<form [formGroup]="form">
  @for (item of formConfig; track item) {
    <div>
      @if (item.type === 'text') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <input matInput [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label">
        </mat-form-field>
      }
      @if (item.type === 'number' || item.type === 'integer') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <input matInput [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label" type="number">
        </mat-form-field>
      }
      @if (item.type === 'date') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <input matInput [matDatepicker]="dp" [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label" />
          <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
          <mat-datepicker #dp></mat-datepicker>
        </mat-form-field>
      }
      @if (item.type === 'timestamp') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <input matInput type="text" [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label">
        </mat-form-field>
      }
      @if (item.type === 'textarea') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <textarea matInput [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label"></textarea>
        </mat-form-field>
      }
      @if (item.type === 'select') {
        <tm-select-field
          [formControl]="getControl(item.name)"
          [item]="item"
          [layerId]="layerId"
        (clearUniqueValueCacheAfterSave)="clearUniqueValueCacheAfterSave.emit($event)"></tm-select-field>
      }
      @if (item.type === 'boolean') {
        <mat-checkbox [formControl]="getControl(item.name)">
          <mat-label>{{ item.label }}</mat-label>
        </mat-checkbox>
      }
    </div>
  }
</form>

@for (item of formConfig; track item) {
  @if (item.type === 'file') {
    @let attachments = attachmentsByAttributeName?.get(item.name);
    @if (attachments && attachments.length > 0) {
      <h2>{{ item.name }} ({{ attachments.length }})</h2>
      @for (attachment of attachments; track attachment) {
        <div>
          <a [href]="attachment.url" [class.deleted]="deletedAttachments.has(attachment.attachmentId)" target="_blank">{{ attachment.fileName }}</a>
          <button mat-stroked-button
                  color="warn"
                  (click)="onDeleteAttachment(attachment.attachmentId)"
                  tmTooltip="Verwijder bijlage">
            <mat-icon svgIcon="remove"></mat-icon>
          </button>
        </div>
      }
    }

    <div class="file-input-wrapper">
      <span>{{ item.label }} toevoegen:</span>
      <input type="file" multiple (change)="onFileChange(item.name, $event)" [placeholder]="item.placeholder || item.label">
    </div>
  }
}
