<form [formGroup]="form">
  @for (item of formConfig; track item) {
    <div>
      @if (item.type === 'text') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <input matInput [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label">
        </mat-form-field>
      }
      @if (item.type === 'number' || item.type === 'integer') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <input matInput [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label" type="number">
        </mat-form-field>
      }
      @if (item.type === 'date') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <input matInput [matDatepicker]="dp" [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label" />
          <mat-datepicker-toggle matSuffix [for]="dp"></mat-datepicker-toggle>
          <mat-datepicker #dp></mat-datepicker>
        </mat-form-field>
      }
      @if (item.type === 'timestamp') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <input matInput type="text" [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label">
        </mat-form-field>
      }
      @if (item.type === 'textarea') {
        <mat-form-field>
          <mat-label>{{ item.label }}</mat-label>
          <textarea matInput [formControl]="getControl(item.name)" [placeholder]="item.placeholder || item.label"></textarea>
        </mat-form-field>
      }
      @if (item.type === 'select') {
        <tm-select-field
          [formControl]="getControl(item.name)"
          [item]="item"
          [layerId]="layerId"
        (clearUniqueValueCacheAfterSave)="clearUniqueValueCacheAfterSave.emit($event)"></tm-select-field>
      }
      @if (item.type === 'boolean') {
        <mat-checkbox [formControl]="getControl(item.name)">
          <mat-label>{{ item.label }}</mat-label>
        </mat-checkbox>
      }
    </div>
  }
</form>

<div class="attachment-wrapper">
  <h2>Bijlagen</h2>
  @for (item of formConfig; track item) {
    @if (item.type === 'file') {
      @let attachments = attachmentsByAttributeName?.get(item.name);
      @let tempAttachments = newAttachments.get(item.name);
      @let totalCount = (attachments ? attachments.length : 0) + (tempAttachments ? tempAttachments.length : 0);
      @if (totalCount > 0) {
        <h2>{{ item.name }} ({{ totalCount }})</h2>
      }
      @if (attachments && attachments.length > 0) {
        @for (attachment of attachments; track attachment) {
          <div class="attachment-row">
            <a [href]="attachment.url" [class.deleted]="deletedAttachments.has(attachment.attachmentId)" target="_blank">{{ attachment.fileName }}</a>
            <!-- input type="text" placeholder="Description" (change)="onFileDescriptionChange(item.name, $event)" -->
            @if (deletedAttachments.has(attachment.attachmentId)) {
              <button mat-icon-button
                      (click)="onDeleteAttachment(attachment.attachmentId)"
                      tmTooltip="Bijlage behouden">
                  <mat-icon svgIcon="reset"></mat-icon>
              </button>
            } @else {
              <button mat-icon-button
                      color="warn"
                      (click)="onDeleteAttachment(attachment.attachmentId)"
                      tmTooltip="Verwijder bijlage">
                <mat-icon svgIcon="remove" color="warn"></mat-icon>
              </button>
            }
          </div>
        }
      }
      @if (tempAttachments && tempAttachments.length > 0) {
        @for (attachment of tempAttachments; track attachment) {
          <div class="attachment-row">
            <div>{{ attachment.name }}</div>
            <button mat-icon-button
                    color="warn"
                    (click)="onRemoveNewAttachment(tempAttachments, item.name, attachment.name)"
                    tmTooltip="Verwijder bijlage">
              <mat-icon svgIcon="remove" color="warn"></mat-icon>
            </button>
          </div>
        }
      }
      <button class="add-attachment-button" mat-flat-button color="accent" (click)="fileInput.click()">
        {{ item.label }} toevoegen
      </button>
      <input type="file" class="hidden" #fileInput multiple (change)="onFileChange(item.name, $event)">
    }
  }
</div>
