@if (node) {
  <div class="layer-settings-form-wrapper">
    <div class="title" i18n="@@admin-core.common.settings-for">Settings for {{ layerTitle }}</div>
    <form [formGroup]="layerSettingsForm" class="layer-settings-form">
      @if (serviceLayer) {
        <tm-admin-catalog-shortcut-buttons [geoServiceId]="serviceLayer.service.id"
                                           [geoServiceLayerId]="serviceLayer.layer.id"
                                           [featureTypeId]="(featureSourceAndType$ | async)?.featureType?.id ?? null"></tm-admin-catalog-shortcut-buttons>
      }
      <mat-form-field>
        <mat-label i18n="@@admin-core.common.title">Title</mat-label>
        <input matInput formControlName="title" />
      </mat-form-field>
      @if (!layerIs3d) {
        <div class="form-field form-field__slider">
          <strong i18n="@@admin-core.application.opacity">Opacity</strong>
          <tm-slider formControlName="opacity"></tm-slider>
        </div>
      }
      <mat-form-field>
        <mat-label i18n="@@admin-core.common.attribution">Attribution</mat-label>
        <input matInput formControlName="attribution" />
      </mat-form-field>
      <mat-form-field>
        <mat-label i18n="@@admin-core.common.description">Description</mat-label>
        <textarea matInput
                  placeholder="Description"
                  i18n-placeholder="@@admin-core.common.description"
                  formControlName="description"
                  [cdkTextareaAutosize]="true"
                  cdkAutosizeMinRows="4"
                  cdkAutosizeMaxRows="10"></textarea>
      </mat-form-field>

      @if (isWMS && availableStyles.length > 1) {
        <div class="available-styles-form-control">
          <strong i18n="@@admin-core.catalog.available-styles" id="available-styles-label">Available styles</strong>
          <mat-selection-list (cdkDropListDropped)="updateListOrder($event)" [cdkDropListData]="availableStyles"
                              aria-labelledby="available-styles-label"
                              cdkDropList
                              class="styles-list"
                              formControlName="selectedStyles">
            @for (style of availableStyles; track style.name) {
              <mat-list-option
                [cdkDragData]="style"
                [lines]="3"
                [tmTooltip]="getStyleTooltip(style)"
                [value]="style"
                cdkDrag
                class="styles-list-item"
                togglePosition="before"
              >
                <span matListItemTitle>{{ style.name }}{{ style.name === defaultStyleName ? ' (default)' : '' }}</span>
                <p matListItemLine>
                  <span>{{ style.title }}</span>
                  <mat-icon cdkDragHandle class="styles-list-drag-handle" svgIcon="reorder"></mat-icon>
                </p>
              </mat-list-option>
            }
          </mat-selection-list>
        </div>
      }

      @if (!layerIs3d) {
        <mat-form-field>
          <mat-label i18n="@@admin-core.application.autoRefreshInSeconds">Auto refresh the layer (seconds)</mat-label>
          <input type="number" matInput formControlName="autoRefreshInSeconds" />
        </mat-form-field>
        <fieldset class="layer-functionality">
          <legend i18n="@@admin-core.application.layerFunctionality">Functionality shown for this layer</legend>
          <mat-checkbox formControlName="showFeatureInfo">
            <span i18n="@@admin-core.application.layerFunctionality.showFeatureInfo">Show in object information</span>
          </mat-checkbox>
          <mat-checkbox formControlName="showInAttributeList">
            <span i18n="@@admin-core.application.layerFunctionality.attributeList">Show in attribute list</span>
          </mat-checkbox>
          <mat-checkbox formControlName="showExport">
            <span i18n="@@admin-core.application.layerFunctionality.export">Show export button in attribute list</span>
          </mat-checkbox>
          <p i18n="@@admin-core.application.layerFunctionality.warning">Note: unchecking these checkboxes only hides user interface controls. Data is still accessible via the API.</p>
        </fieldset>
        @if (featureSourceAndType$ | async; as featureSourceAndType) {
          @if (featureSourceAndType.featureType?.hasAttributes) {
            <div class="edit-layer-attributes">
              <button mat-stroked-button
                      (click)="editAppLayerAttribute($event, featureSourceAndType)">
                <span i18n="@@admin-core.application.edit-application-layer-attributes">Edit application layer attributes</span>
                <mat-icon svgIcon="edit_square" iconPositionEnd></mat-icon>
              </button>
            </div>
          }
        }
        <span [tmTooltip]="editableTooltip$ | async">
      <mat-checkbox formControlName="editable">
        <span i18n="@@admin-core.application.editable">Editable</span>
      </mat-checkbox>
    </span>
        @if (layerSettingsForm.get('editable')?.value) {
          <div class="form-selection-and-message">
            @if ((selectableForms$ | async)?.length) {
              <mat-form-field>
                <mat-label i18n="@@admin-core.application.select-form">Select (optional) form</mat-label>
                <mat-select formControlName="formId">
                  <mat-option [value]="null" i18n="@@admin-core.application.no-form">No form</mat-option>
                  @for (form of (selectableForms$ | async); track form.id) {
                    <mat-option [value]="form.id">{{form.name}}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              @if (formWarningMessageData$ | async; as formWarningMessageData) {
                <tm-admin-form-warning-message [featureType]="formWarningMessageData.featureType"
                                               [applicationLayerSetting]="formWarningMessageData.layerSetting"
                                               [form]="formWarningMessageData.form"></tm-admin-form-warning-message>
              }
            } @else {
              <div i18n="@@admin-core.application.no-forms-for-feature-type">There are no forms for this feature type</div>
            }
          </div>
        }
        @if (projectionAvailability$ | async; as projectionAvailability) {
          <div class="available-crs">
            <tm-admin-projection-availability [projectionAvailability]="projectionAvailability"></tm-admin-projection-availability>
          </div>
        }
        @if ((searchIndexEnabled$ | async)) {
          @if ((selectableSearchIndexes$ | async)?.length) {
            <mat-form-field>
              <mat-label i18n="@@admin-core.application.select-search-index">Select search index</mat-label>
              <mat-select formControlName="searchIndexId">
                <mat-option [value]="null" i18n="@@admin-core.application.no-search-index">No search index</mat-option>
                @for (searchIndex of (selectableSearchIndexes$ | async); track searchIndex.id) {
                  <mat-option [value]="searchIndex.id">{{ searchIndex.name }}</mat-option>
                }
              </mat-select>
            </mat-form-field>
          } @else {
            <div i18n="@@admin-core.application.no-search-indexes-for-feature-type">There are no search indexes for this feature type</div>
          }
        }
      }
      @if (layerIs3dTiles) {
        <div class="set-tileset-style">
          <strong class="set-tileset-style-label" i18n="@@admin-core.application.set-tileset-style">Set a style for the 3D Tileset</strong>
          @if (tilesetStyleErrorMessage) {
            <div class="tileset-style-error-message">
              <tm-error-message [message]="tilesetStyleErrorMessage" [friendlyError]="true">
              </tm-error-message>
            </div>
          }
          <mat-form-field>
            <mat-label i18n="@@admin-core.application.tileset-style">Tileset style</mat-label>
            <textarea matInput formControlName="tileset3dStyle"
                      [cdkTextareaAutosize]="true"
                      cdkAutosizeMinRows="4"
                      cdkAutosizeMaxRows="12">
        </textarea>
          </mat-form-field>
          <div class="hint" i18n="@@admin-core.application.tileset-style-hint">Fill in a tileset style in json format according to the <a href="https://docs.ogc.org/cs/22-025r4/22-025r4.html#toc45" target="_blank" rel="noopener">OGC 3D Tiles Styling Language</a>. Note: The structure of the style is validated, but not the style expressions.</div>
        </div>
      }
    </form>
  </div>
}
