<h2 i18n="@@admin-core.tasks.task.information">Task Information</h2>

<ng-template #infoString let-infoType="infoType" let-infoValue="infoValue">
  <div class="row">
    <div class="label">{{ infoType }}</div>
    @if (infoValue) {
      <div class="info-value">{{ infoValue }}</div>
    } @else {
      <div class="info-value" i18n="@@admin-core.tasks.task.no-value"> No {{ infoType }} found</div>
    }
  </div>
</ng-template>

<div class="information">

  <div class="standard-information">
    <ng-container
      [ngTemplateOutlet]="infoString"
      [ngTemplateOutletContext]="{infoType: 'Description', infoValue: (task$ | async)?.description }"/>

    <ng-container
      [ngTemplateOutlet]="infoString"
      [ngTemplateOutletContext]="{infoType: 'Uuid', infoValue: (task$ | async)?.uuid }"/>

    <ng-container
      [ngTemplateOutlet]="infoString"
      [ngTemplateOutletContext]="{infoType: 'Type', infoValue: (task$ | async)?.type }"/>

  </div>

  @if (taskDetails$ | async) {
    <div class="detailed-information">
      <ng-container
        [ngTemplateOutlet]="infoString"
        [ngTemplateOutletContext]="{infoType: 'Status', infoValue: (taskDetails$ | async)?.status }"/>

      <ng-container
        [ngTemplateOutlet]="infoString"
        [ngTemplateOutletContext]="{infoType: 'Last result', infoValue: (taskDetails$ | async)?.lastResult }"/>

      <ng-container
        [ngTemplateOutlet]="infoString"
        [ngTemplateOutletContext]="{infoType: 'Progress', infoValue: (taskDetails$ | async)?.progress }"/>

      <ng-container
        [ngTemplateOutlet]="infoString"
        [ngTemplateOutletContext]="{infoType: 'Last time the task was started', infoValue: ((taskDetails$ | async)?.lastTime | date: 'medium') }"/>

      <ng-container
        [ngTemplateOutlet]="infoString"
        [ngTemplateOutletContext]="{infoType: 'Start time', infoValue: ((taskDetails$ | async)?.startTime | date: 'medium') }"/>

      <div class="job-data">
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Additional job data</mat-panel-title>
          </mat-expansion-panel-header>
          @for (item of (taskDetails$ | async)?.jobData | keyvalue; track $index) {
            <ng-container
              [ngTemplateOutlet]="infoString"
              [ngTemplateOutletContext]="{infoType: item.key, infoValue: item.value }"/>
          }
        </mat-expansion-panel>
      </div>

      <div class="schedule">
        <mat-expansion-panel>
          <mat-expansion-panel-header>
            <mat-panel-title>Scheduled fire times</mat-panel-title>
          </mat-expansion-panel-header>
          @for (time of (taskDetails$ | async)?.nextFireTimes; track $index) {
            <ng-container
              [ngTemplateOutlet]="infoString"
              [ngTemplateOutletContext]="{infoType: '', infoValue: time | date: 'medium' }"/>
          }
        </mat-expansion-panel>
      </div>

    </div>
  } @else {
    <div class="error-message">
      <tm-error-message [message]="loadErrorMessage$ | async"></tm-error-message>
    </div>
  }


</div>

@if (deleteErrorMessage$ |async) {
  <div class="error-message">
    <tm-error-message [message]="deleteErrorMessage$ | async"></tm-error-message>
  </div>
}

<div class="page-details-actions controls-buttons">
  <button mat-flat-button color="primary" (click)="start()" i18n="@@admin-core.tasks.task.start">Start</button>
  <button mat-flat-button (click)="stop()" i18n="@@admin-core.tasks.task.stop">Stop</button>
  <button mat-flat-button color="warn" (click)="delete()" i18n="@@admin-core.common.delete">Delete</button>
</div>
